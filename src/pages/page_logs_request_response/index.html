<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request&Response</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="./icon.png">
</head>
<body>
    <div class="container">
        <h1>STATUS</h1>

        <div class="boxMain">
            <div class="boxLeft_request">
                <div class="titleReq">REQUEST</div>
                <div class="boxInforOfReq">
                    <textarea class="inputForm request-0" placeholder="Method"></textarea>
                    <textarea class="inputForm request-1" placeholder="Path"></textarea>
                    <textarea class="inputForm request-2" placeholder="Headers"></textarea>
                    <textarea class="inputForm request-3" placeholder="Body"></textarea>
                </div>
            </div>
            <div class="boxRight_response">
                <div class="titleRes">RESPONSE</div>
                <div class="boxInforOfRes">
                    <textarea class="inputForm response-0" placeholder="Status"></textarea>
                    <textarea class="inputForm response-1" placeholder="Body"></textarea>
                    <textarea class="inputForm response-2" placeholder="Timestamp"></textarea>
                    <textarea class="inputForm response-3" placeholder="N/A"></textarea>
                </div>
            </div>
        </div>
        <button class="btn-refresh" onclick="refreshLogs()">
            <span class="refresh-icon">Refresh</span>
        </button>
    </div>

    <script>
        // Hàm để lấy và hiển thị log
        async function fetchAndDisplayLogs() {
    try {
        const response = await fetch('/logs');
        const logs = await response.json();
        if (!logs || logs.length === 0) return;

        // Lấy REQUEST gần nhất
        const latestRequest = [...logs].reverse().find(l => l.type === 'REQUEST');
        if (latestRequest) {
            document.querySelector('.request-0').value = latestRequest.method || '';
            document.querySelector('.request-1').value = latestRequest.path || '';
            document.querySelector('.request-2').value = JSON.stringify(latestRequest.headers, null, 2) || '';
            document.querySelector('.request-3').value = JSON.stringify(latestRequest.body, null, 2) || '';
        }

        // Lấy RESPONSE gần nhất
        const latestResponse = [...logs].reverse().find(l => l.type === 'RESPONSE');
        if (latestResponse) {
            document.querySelector('.response-0').value = latestResponse.statusCode || '';
            document.querySelector('.response-1').value = JSON.stringify(latestResponse.body, null, 2) || '';
            document.querySelector('.response-2').value = latestResponse.timestamp || '';
            document.querySelector('.response-3').value = '';
        }
    } catch (err) {
        console.error(err);
    }
}

// Refresh với animation nhẹ
async function refreshLogs() {
    const btn = document.querySelector('.btn-refresh');
    btn.disabled = true;
    btn.textContent = 'Refreshing...';

    await fetchAndDisplayLogs();

    btn.disabled = false;
    btn.textContent = 'Refresh';
}


        
        // Gọi hàm khi trang tải
        window.addEventListener('load', fetchAndDisplayLogs);
                document.querySelector('.boxInforOfReq .inputForm').value = logs
        .filter(log => log.type === 'REQUEST')
        .map(log => `[${log.timestamp}] ${log.action} ${log.method} ${log.path}\n${JSON.stringify(log.body, null, 2)}`)
        .join('\n\n');
        document.querySelector('.boxInforOfRes .inputForm').value = logs
        .filter(log => log.type === 'RESPONSE')
        .map(log => `[${log.timestamp}] ${log.action} ${log.method} ${log.statusCode}\n${JSON.stringify(log.body, null, 2)}`)
        .join('\n\n');
        // Tùy chọn: Cập nhật log theo thời gian thực (mỗi 5 giây)
        // setInterval(fetchAndDisplayLogs, 5000);
    </script>
    
</body>
</html>