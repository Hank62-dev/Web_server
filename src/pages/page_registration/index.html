<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <title>Register</title>
</head>
<body>
    <div class="container">
        <!-- Cột trái -->
        <div class="col left">
            <div class="left register_frame">
                <div class="boxTitle">
                    <h1>Registration</h1>
                </div>
                <div class="boxUsername">
                    <input id="username" placeholder="Username" type="text" required>
                </div>
                <div class="boxEmail">
                    <input id="email" placeholder="Email" type="email" required>
                </div>
                <div class="boxPassword">
                    <input id="password" placeholder="Password" type="password" required>
                </div>
                <div class="boxConfirm">
                    <button id="btn_register">Register</button>
                </div>
                <div class="socialLoginBox">or login with social platforms</div>
                <div class="socialIcon">
                    <i class="fa-brands fa-google"></i>
                    <i class="fa-brands fa-facebook-f"></i>
                    <i class="fa-brands fa-github"></i>
                    <i class="fa-brands fa-linkedin-in"></i>
                </div>
            </div>
        </div>

        <!-- Cột phải -->
        <div class="col right">
            <div class="right_frame">
                <div class="right intro">
                    <h1>Welcome Back!</h1>
                </div>
                <div class="right prompt_to_login">
                    <p>Already have an account?</p>
                </div>
                <div class="right loginBox">
                    <div class="loginBox login_button">
                        <button id="login">Login</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.addEventListener("load", () => {
            setTimeout(() => {
                document.querySelector(".right_frame").classList.add("show");
                document.querySelector(".register_frame").classList.add("show");
            }, 500); // chờ 0.5 giây mới fade in
        });

        // Logic cho nút Login
        document.getElementById("login").addEventListener("click", function() {
            document.querySelector(".right").classList.add("element_slide_out");
            document.querySelector(".left").classList.add("fade_out");

            document.querySelector(".right_frame").classList.remove("show");
            document.querySelector(".register_frame").classList.remove("show");
            setTimeout(function() {
                document.querySelector(".container").classList.add("right_expand");
            }, 1200);

            setTimeout(function() {
                document.querySelector(".container").classList.remove("right_expand");
                document.querySelector(".container").classList.add("prepare_move_to_login");
            }, 2800);

            setTimeout(function() {
                document.querySelector(".container").classList.remove("prepare_move_to_login");
                document.querySelector(".container").classList.add("pink_slide_out");
            }, 3000);

            setTimeout(() => {
                window.location.href = "../page_login/index.html";
            }, 4500);
        });

        // Logic cho nút Register
        document.getElementById("btn_register").addEventListener("click", async function(e) {
            e.preventDefault(); // Ngăn form reload trang nếu có

            // Lấy giá trị từ input
            const username = document.getElementById("username").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            // Kiểm tra các trường có rỗng không
            if (!username || !email || !password) {
                alert("Please fill in all fields");
                return;
            }

            // Gửi POST request
            try {
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, email, password })
                });

                const result = await response.json();
                console.log('Response:', result);

                if (response.ok) {
                    alert(result.message); // Thông báo thành công
                    // Tùy chọn: chuyển hướng sau khi đăng ký thành công
                    setTimeout(() => {
                        window.location.href = "../page_login/index.html";
                    }, 1000);
                } else {
                    alert(result.message || 'Registration failed');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred during registration');
            }
        });
    </script>
</body>
</html>